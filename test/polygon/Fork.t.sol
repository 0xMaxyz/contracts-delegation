// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.19;

import "./DeltaSetup.f.sol";

contract ForkTestPolygon is DeltaSetup {
    function setUp() public virtual override {
        vm.createSelectFork({blockNumber: 59791824, urlOrAlias: "https://polygon-rpc.com"});
        address admin = 0x999999833d965c275A2C102a4Ebf222ca938546f;
        address proxy = 0x6A6faa54B9238f0F079C8e6CBa08a7b9776C7fE4;
        address oldModule = 0x11e676D51e01b90c162a640065d58B30c0F3DA04;
        upgradeExistingDelta(proxy, admin, oldModule);
    }

    // skipt this one for now
    function test_permit_polygon() external /** address user, uint8 lenderId */ {
        address user = 0x91ae002a960e63Ccb0E5bDE83A8C13E51e1cB91A;
        vm.prank(user);
        // vm.expectRevert(); // should revert with overflow
        IFlashAggregator(brokerProxyAddress).deltaCompose(getSwapWithPermit());
    }

    function getSwapWithPermit() internal pure returns (bytes memory data) {
        // this data is incorrect
        data = hex"3280ca0d8c38d2e2bcbab66aa1648bd1c7160500fe00e000000000000000000000000091ae002a960e63ccb0e5bde83a8c13e51e1cb91a0000000000000000000000006a6faa54b9238f0f079c8e6cba08a7b9776c7fe4000000000000000000000000000000000000000000000001ef6f8d60f6ba60ed0000000000000000000000000000000000000000000000000000000066a253e3000000000000000000000000000000000000000000000000000000000000001c77be82fd59a237803a5e903a94037d54f7c8e03944cfc330300f29f13c7bb7a778bd99fa3e0a789a6dd88e8512662c20775b167cf6571c21f68e4b24cfd171e83401fa68fb4628dff1028cfec22b4162fccd0d45efb6000000000001ea87cb586658376a021704fa68fb4628dff1028cfec22b4162fccd0d45efb64e3288c9ca110bcc82bf38f09a7b425c095d92bf4e3288c9ca110bcc82bf38f09a7b425c095d92bf000000000001ea87cb586658376a015a83bd37f90001fa68fb4628dff1028cfec22b4162fccd0d45efb600010d500b1d8e8ef31e21c99d1db9a6444d3adf12700901ea87cb586658376a0902261e705aed6e000000c49b0001a8376f53391a041c8236a232f7f019ea76eed86d000000016a6faa54b9238f0f079c8e6cba08a7b9776c7fe4000000000703030601542a9fff290100010201897ce2c30a02010103cd78a20c597e367a4e478a2411ceb790604d7c8f000000000000000000000c22000f0201040100020f0201050200ff0000000000000000000000000000000000000000000000000000fa68fb4628dff1028cfec22b4162fccd0d45efb62791bca1f2de4661ed88a30c99a7a9449aa841740d500b1d8e8ef31e21c99d1db9a6444d3adf12709aa18301055091e9da7c57b81633632fa33b9a80a374094527e1673a86de625aa59517c5de346d3200000000000000000000000000000000000000000000000000000000100d500b1d8e8ef31e21c99d1db9a6444d3adf127091ae002a960e63ccb0e5bde83a8c13e51e1cb91a00000000000000000000000000000013fa68fb4628dff1028cfec22b4162fccd0d45efb66a6faa54b9238f0f079c8e6cba08a7b9776c7fe400000000000001eac6950c0729ecb022fa68fb4628dff1028cfec22b4162fccd0d45efb691ae002a960e63ccb0e5bde83a8c13e51e1cb91a000000000000000000000000000000";
    }
}
