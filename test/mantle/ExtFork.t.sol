// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.19;

import "./DeltaSetup.f.sol";

contract ForkTestMantle is DeltaSetup {
    address user = 0x334d52E24d452fa20489f07Bd943b7cF943Cb881;
    address initProxy = 0xc08BFef7E778f3519D79E96780b77066F5d4FCC0;

    function setUp() public override {
        vm.createSelectFork({blockNumber: 67_140_057, urlOrAlias: "https://rpc.mantle.xyz"});
        address admin = 0x999999833d965c275A2C102a4Ebf222ca938546f;
        address proxy = 0x9bc92bF848FaF2355c429c54d1edE3e767bDd790;
        address oldModule = 0x6aAb342eF29370B57Bf74e1b7e71b9A018137a20;
        upgradeExistingDelta(proxy, admin, oldModule);
    }

    function test_init_fork() external {
        vm.prank(user);
        (bool success, bytes memory ret) = address(initProxy).call(getCalldata());
        if (!success) {
            // Next 5 lines from https://ethereum.stackexchange.com/a/83577
            if (ret.length < 68) {
                console.logBytes(ret);
                revert("unexpected error");
            }
            assembly {
                ret := add(ret, 0x04)
            }
            revert(abi.decode(ret, (string)));
        }
    }

    function getCalldata() internal pure returns (bytes memory data) {
        data = hex"ac9650d80000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000480000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000003e47723dda1000000000000000000000000201eba5cc46d216ce6dc03f6a759e8e766e956ae00000000000000000000000009bc4e0d864854c6afb6eb9a9cdf58ac190d0df9414eec96c005f7e2995aaf4ac4364d74e8b46d43e7c28a4ceacd91fb92d7b0aa0000000000000000000000000000000000000000000000000000000000f024af0000000000000000000000009bc92bf848faf2355c429c54d1ede3e767bdd79000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000002e417d730910000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000029801c08bfef7e778f3519d79e96780b77066f5d4fcc000000000000000000000000000240ac90000000000000000000000240528004209bc4e0d864854c6afb6eb9a9cdf58ac190d0df900658e3a13418743ab1a98434551937ea687e451b58926f2201eba5cc46d216ce6dc03f6a759e8e766e956aeff0901c08bfef7e778f3519d79e96780b77066f5d4fcc0000000000000000000000000000c035400000000000000000000000c01b8004209bc4e0d864854c6afb6eb9a9cdf58ac190d0df90066f9810e40f60f80efc51e7a4d62f7a591ad52d27e26f7201eba5cc46d216ce6dc03f6a759e8e766e956aeff0901c08bfef7e778f3519d79e96780b77066f5d4fcc000000000000000000000000000b419130000000000000000000000b419c9006e09bc4e0d864854c6afb6eb9a9cdf58ac190d0df900011858d52cf57c07a018171d7a1e68dc081f17144f01f478c1b0c915c4faa5fffa6cabf0219da63d7f4cb800064cdfc22bf05209de87ee564746dc7e5174631d2b01f4201eba5cc46d216ce6dc03f6a759e8e766e956aeff0901c08bfef7e778f3519d79e96780b77066f5d4fcc0000000000000000000000000000bfd7d00000000000000000000000c04ca009a09bc4e0d864854c6afb6eb9a9cdf58ac190d0df900019cd55b03c64b65ba02a1d985caef63046b2d54eb00645be26527e817998a7206475496fde1e68957c5a6000119d4a14396914daf44d45a9ffdb5e81b8df1a5ed09c478c1b0c915c4faa5fffa6cabf0219da63d7f4cb800043cdb91874496844f109c2a3a0e31d143645463292710201eba5cc46d216ce6dc03f6a759e8e766e956aeff0922201eba5cc46d216ce6dc03f6a759e8e766e956aec08bfef7e778f3519d79e96780b77066f5d4fcc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004422867d78000000000000000000000000201eba5cc46d216ce6dc03f6a759e8e766e956ae414eec96c005f7e2995aaf4ac4364d74e8b46d43e7c28a4ceacd91fb92d7b0aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002401681a6200000000000000000000000009bc4e0d864854c6afb6eb9a9cdf58ac190d0df900000000000000000000000000000000000000000000000000000000";
    }
}
